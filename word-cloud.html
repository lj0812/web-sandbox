<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯äº‘å¯è§†åŒ–ç»„ä»¶</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .controls {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #ffecd2, #fcb69f);
            color: #333;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-left: auto;
        }

        .input-group label {
            font-weight: 500;
            color: #495057;
        }

        .input-group input {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
            width: 80px;
        }

        .word-cloud-container {
            position: relative;
            width: 100%;
            height: 600px;
            background: radial-gradient(circle at center, #ffffff 0%, #f8f9fa 100%);
            overflow: hidden;
            border-radius: 0 0 15px 15px;
        }

        .word-cloud {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .word-item {
            position: absolute;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s ease;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            white-space: nowrap;
        }

        .word-item:hover {
            transform: scale(1.1);
            z-index: 1000;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #6c757d;
            font-size: 18px;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 3000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.success {
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
        }

        .notification.error {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
        }

        .notification.show {
            transform: translateX(0);
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .controls {
                padding: 15px 20px;
                flex-direction: column;
                align-items: stretch;
            }

            .input-group {
                margin-left: 0;
                justify-content: center;
            }

            .word-cloud-container {
                height: 400px;
            }

            .btn {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .word-cloud-container {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š è¯äº‘å¯è§†åŒ–ç»„ä»¶</h1>
            <p>æ™ºèƒ½è¯äº‘ç”Ÿæˆå™¨ - æ–‡å­—å¤§å°ã€é¢œè‰²ã€ä½ç½®è‡ªåŠ¨ä¼˜åŒ–</p>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="generateWordCloud()">
                ğŸ¨ ç”Ÿæˆè¯äº‘
            </button>
            <button class="btn btn-secondary" onclick="copyToClipboard()">
                ğŸ“‹ å¤åˆ¶å†…å®¹
            </button>
            <button class="btn btn-secondary" onclick="downloadImage()">
                ğŸ’¾ ä¸‹è½½å›¾ç‰‡
            </button>

            <div class="input-group">
                <label for="wordCount">è¯è¯­æ•°é‡:</label>
                <input type="number" id="wordCount" value="30" min="10" max="100">
            </div>
        </div>

        <div class="word-cloud-container">
            <div class="word-cloud" id="wordCloud">
                <div class="loading">æ­£åœ¨ç”Ÿæˆè¯äº‘...</div>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>
    <div class="notification" id="notification"></div>

    <script>
        // ç¤ºä¾‹è¯è¯­æ•°æ®
        const sampleWords = [
            { text: "äººå·¥æ™ºèƒ½", weight: 100 },
            { text: "æœºå™¨å­¦ä¹ ", weight: 90 },
            { text: "æ·±åº¦å­¦ä¹ ", weight: 85 },
            { text: "æ•°æ®ç§‘å­¦", weight: 80 },
            { text: "è‡ªç„¶è¯­è¨€å¤„ç†", weight: 75 },
            { text: "è®¡ç®—æœºè§†è§‰", weight: 70 },
            { text: "ç¥ç»ç½‘ç»œ", weight: 65 },
            { text: "å¤§æ•°æ®", weight: 60 },
            { text: "äº‘è®¡ç®—", weight: 55 },
            { text: "åŒºå—é“¾", weight: 50 },
            { text: "ç‰©è”ç½‘", weight: 45 },
            { text: "é‡å­è®¡ç®—", weight: 40 },
            { text: "è¾¹ç¼˜è®¡ç®—", weight: 38 },
            { text: "æ•°å­—åŒ–è½¬å‹", weight: 36 },
            { text: "äººæœºäº¤äº’", weight: 34 },
            { text: "è™šæ‹Ÿç°å®", weight: 32 },
            { text: "å¢å¼ºç°å®", weight: 30 },
            { text: "5Gç½‘ç»œ", weight: 28 },
            { text: "ç½‘ç»œå®‰å…¨", weight: 26 },
            { text: "æ•°æ®æŒ–æ˜", weight: 24 },
            { text: "ç®—æ³•ä¼˜åŒ–", weight: 22 },
            { text: "æ¨¡å¼è¯†åˆ«", weight: 20 },
            { text: "æ™ºèƒ½æ¨è", weight: 18 },
            { text: "è¯­éŸ³è¯†åˆ«", weight: 16 },
            { text: "å›¾åƒå¤„ç†", weight: 14 },
            { text: "çŸ¥è¯†å›¾è°±", weight: 12 },
            { text: "å¼ºåŒ–å­¦ä¹ ", weight: 10 },
            { text: "è”é‚¦å­¦ä¹ ", weight: 8 },
            { text: "è¿ç§»å­¦ä¹ ", weight: 6 },
            { text: "ç”Ÿæˆå¯¹æŠ—ç½‘ç»œ", weight: 4 },
            { text: "transformer", weight: 3 },
            { text: "attentionæœºåˆ¶", weight: 2 },
            { text: "é¢„è®­ç»ƒæ¨¡å‹", weight: 1 }
        ];

        // é¢œè‰²ä¸»é¢˜
        const colorSchemes = [
            ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7'],
            ['#6C5CE7', '#A29BFE', '#FD79A8', '#FDCB6E', '#E17055'],
            ['#00B894', '#00CEC9', '#74B9FF', '#A29BFE', '#FD79A8'],
            ['#E84393', '#A29BFE', '#74B9FF', '#00CEC9', '#55A3FF'],
            ['#FF7675', '#74B9FF', '#55A3FF', '#00B894', '#FDCB6E']
        ];

        let currentWords = [];
        let wordElements = [];

        class WordCloudGenerator {
            constructor(container) {
                this.container = container;
                this.width = container.offsetWidth;
                this.height = container.offsetHeight;
                this.centerX = this.width / 2;
                this.centerY = this.height / 2;
                this.occupiedAreas = [];
            }

            // æ£€æŸ¥ä¸¤ä¸ªçŸ©å½¢æ˜¯å¦é‡å 
            isOverlapping(rect1, rect2, margin = 15) {
                return !(rect1.right + margin < rect2.left ||
                        rect2.right + margin < rect1.left ||
                        rect1.bottom + margin < rect2.top ||
                        rect2.bottom + margin < rect1.top);
            }

            // è·å–å…ƒç´ å®é™…å°ºå¯¸
            getElementDimensions(element) {
                // åˆ›å»ºä¸´æ—¶æµ‹é‡å®¹å™¨
                const measure = document.createElement('div');
                measure.style.position = 'absolute';
                measure.style.visibility = 'hidden';
                measure.style.pointerEvents = 'none';
                measure.style.left = '0px';
                measure.style.top = '0px';
                measure.style.fontSize = element.style.fontSize;
                measure.style.fontFamily = element.style.fontFamily || 'Microsoft YaHei, Arial, sans-serif';
                measure.style.fontWeight = element.style.fontWeight || 'bold';
                measure.style.whiteSpace = 'nowrap';
                measure.textContent = element.textContent;

                document.body.appendChild(measure);
                const rect = measure.getBoundingClientRect();
                const width = rect.width;
                const height = rect.height;
                document.body.removeChild(measure);

                return { width, height };
            }

            // è®¡ç®—æ–‡å­—çš„è¾¹ç•ŒçŸ©å½¢ï¼ˆè€ƒè™‘æ—‹è½¬ï¼‰
            getTextBounds(element, x, y, rotation) {
                const { width, height } = this.getElementDimensions(element);

                if (Math.abs(rotation) < 1) {
                    return {
                        left: x - width / 2,
                        top: y - height / 2,
                        right: x + width / 2,
                        bottom: y + height / 2,
                        width: width,
                        height: height
                    };
                }

                // æ›´å‡†ç¡®çš„æ—‹è½¬åè¾¹ç•Œæ¡†è®¡ç®—
                const rad = Math.abs(rotation) * Math.PI / 180;
                const cos = Math.cos(rad);
                const sin = Math.sin(rad);

                // è®¡ç®—æ—‹è½¬ååŒ…å›´ç›’çš„å®é™…å¤§å°
                const newWidth = Math.abs(width * cos) + Math.abs(height * sin);
                const newHeight = Math.abs(width * sin) + Math.abs(height * cos);

                return {
                    left: x - newWidth / 2,
                    top: y - newHeight / 2,
                    right: x + newWidth / 2,
                    bottom: y + newHeight / 2,
                    width: newWidth,
                    height: newHeight
                };
            }

            // èºæ—‹æŸ¥æ‰¾å¯ç”¨ä½ç½®
            findPosition(element, fontSize, rotation) {
                const attempts = 2000;
                let angle = 0;
                let radius = 0;
                const radiusStep = Math.max(2, fontSize * 0.15); // åŠ¨æ€æ­¥é•¿

                // é¦–å…ˆå°è¯•ä¸­å¿ƒä½ç½®
                if (this.occupiedAreas.length === 0) {
                    const bounds = this.getTextBounds(element, this.centerX, this.centerY, rotation);
                    if (bounds.left >= 20 && bounds.right <= this.width - 20 &&
                        bounds.top >= 20 && bounds.bottom <= this.height - 20) {
                        this.occupiedAreas.push(bounds);
                        return { x: this.centerX, y: this.centerY };
                    }
                }

                for (let i = 0; i < attempts; i++) {
                    const x = this.centerX + radius * Math.cos(angle);
                    const y = this.centerY + radius * Math.sin(angle);

                    // æ£€æŸ¥æ˜¯å¦åœ¨å®¹å™¨å†…ï¼ˆç•™æ›´å¤šè¾¹è·ï¼‰
                    const bounds = this.getTextBounds(element, x, y, rotation);
                    if (bounds.left >= 20 && bounds.right <= this.width - 20 &&
                        bounds.top >= 20 && bounds.bottom <= this.height - 20) {

                        // æ£€æŸ¥æ˜¯å¦ä¸å…¶ä»–å…ƒç´ é‡å 
                        let hasCollision = false;
                        for (let area of this.occupiedAreas) {
                            if (this.isOverlapping(bounds, area)) {
                                hasCollision = true;
                                break;
                            }
                        }

                        if (!hasCollision) {
                            this.occupiedAreas.push(bounds);
                            return { x, y };
                        }
                    }

                    // æ”¹è¿›çš„èºæ—‹é€’å¢
                    angle += 0.3;
                    radius += radiusStep * 0.3;
                }

                // å¦‚æœæ‰¾ä¸åˆ°ä½ç½®ï¼Œå°è¯•æ›´å®½çš„æœç´¢èŒƒå›´
                for (let i = 0; i < 100; i++) {
                    const x = this.centerX + (Math.random() - 0.5) * this.width * 0.9;
                    const y = this.centerY + (Math.random() - 0.5) * this.height * 0.9;

                    const bounds = this.getTextBounds(element, x, y, 0); // ä¸æ—‹è½¬é™ä½ç¢°æ’
                    if (bounds.left >= 10 && bounds.right <= this.width - 10 &&
                        bounds.top >= 10 && bounds.bottom <= this.height - 10) {

                        let hasCollision = false;
                        for (let area of this.occupiedAreas) {
                            if (this.isOverlapping(bounds, area, 10)) {
                                hasCollision = true;
                                break;
                            }
                        }

                        if (!hasCollision) {
                            this.occupiedAreas.push(bounds);
                            return { x, y, forceNoRotation: true };
                        }
                    }
                }

                // æœ€åçš„é™çº§æ–¹æ¡ˆ
                return {
                    x: this.centerX + (Math.random() - 0.5) * this.width * 0.6,
                    y: this.centerY + (Math.random() - 0.5) * this.height * 0.6,
                    forceNoRotation: true
                };
            }

            // ç”Ÿæˆè¯äº‘
            generate(words) {
                this.container.innerHTML = '';
                this.occupiedAreas = [];
                wordElements = [];

                // è·å–å½“å‰ä¸»é¢˜é¢œè‰²
                const colors = colorSchemes[Math.floor(Math.random() * colorSchemes.length)];

                // æŒ‰æƒé‡æ’åºï¼Œæƒé‡é«˜çš„å…ˆæ”¾ç½®
                const sortedWords = [...words].sort((a, b) => b.weight - a.weight);

                sortedWords.forEach((word, index) => {
                    const element = document.createElement('div');
                    element.className = 'word-item';
                    element.textContent = word.text;

                    // è®¡ç®—å­—ä½“å¤§å°ï¼ˆæƒé‡è¶Šé«˜å­—ä½“è¶Šå¤§ï¼‰
                    const fontSize = Math.max(12, Math.min(60, word.weight * 0.8 + 12));

                    // éšæœºæ—‹è½¬è§’åº¦ï¼ˆé™åˆ¶åœ¨å¯è¯»æ€§èŒƒå›´å†…ï¼‰
                    let rotation = (Math.random() - 0.5) * 40; // -20åˆ°20åº¦

                    // å¯¹äºé•¿æ–‡æœ¬ï¼Œå‡å°‘æ—‹è½¬è§’åº¦
                    if (word.text.length > 4) {
                        rotation = (Math.random() - 0.5) * 20; // -10åˆ°10åº¦
                    }

                    // éšæœºé¢œè‰²
                    const color = colors[Math.floor(Math.random() * colors.length)];

                    element.style.fontSize = fontSize + 'px';
                    element.style.color = color;
                    element.style.transform = `rotate(${rotation}deg)`;

                    // ä¸´æ—¶æ·»åŠ åˆ°å®¹å™¨ä¸­ä»¥è®¡ç®—å°ºå¯¸
                    element.style.position = 'absolute';
                    element.style.left = '-9999px';
                    this.container.appendChild(element);

                    // æŸ¥æ‰¾åˆé€‚ä½ç½®
                    const position = this.findPosition(element, fontSize, rotation);

                    // å¦‚æœä½ç½®æŸ¥æ‰¾å»ºè®®ä¸æ—‹è½¬ï¼Œåˆ™å–æ¶ˆæ—‹è½¬
                    if (position.forceNoRotation) {
                        rotation = 0;
                    }

                    // è®¾ç½®æœ€ç»ˆä½ç½®
                    element.style.left = position.x + 'px';
                    element.style.top = position.y + 'px';
                    element.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;

                    // æ·»åŠ äº¤äº’æ•ˆæœ
                    this.addInteractivity(element, word);

                    wordElements.push({ element, word, position, rotation });
                });
            }

            // æ·»åŠ äº¤äº’æ•ˆæœ
            addInteractivity(element, word) {
                const tooltip = document.getElementById('tooltip');

                element.addEventListener('mouseenter', (e) => {
                    tooltip.textContent = `${word.text} (æƒé‡: ${word.weight})`;
                    tooltip.style.opacity = '1';
                });

                element.addEventListener('mousemove', (e) => {
                    tooltip.style.left = e.pageX + 10 + 'px';
                    tooltip.style.top = e.pageY - 30 + 'px';
                });

                element.addEventListener('mouseleave', () => {
                    tooltip.style.opacity = '0';
                });

                element.addEventListener('click', () => {
                    showNotification(`æ‚¨ç‚¹å‡»äº†: ${word.text}`, 'success');
                });
            }
        }

        // ç”Ÿæˆè¯äº‘
        function generateWordCloud() {
            const container = document.getElementById('wordCloud');
            const wordCount = parseInt(document.getElementById('wordCount').value);

            // éšæœºé€‰æ‹©è¯è¯­
            const shuffled = [...sampleWords].sort(() => Math.random() - 0.5);
            currentWords = shuffled.slice(0, wordCount);

            const generator = new WordCloudGenerator(container);
            generator.generate(currentWords);

            showNotification('è¯äº‘ç”Ÿæˆå®Œæˆï¼', 'success');
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        async function copyToClipboard() {
            if (currentWords.length === 0) {
                showNotification('è¯·å…ˆç”Ÿæˆè¯äº‘ï¼', 'error');
                return;
            }

            const content = currentWords.map(word => word.text).join(', ');

            try {
                await navigator.clipboard.writeText(content);
                showNotification('è¯äº‘å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
            } catch (err) {
                // é™çº§æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = content;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('è¯äº‘å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
            }
        }

        // ä¸‹è½½å›¾ç‰‡
        function downloadImage() {
            if (wordElements.length === 0) {
                showNotification('è¯·å…ˆç”Ÿæˆè¯äº‘ï¼', 'error');
                return;
            }

            const container = document.getElementById('wordCloud');

            // ä½¿ç”¨html2canvasåº“è¿›è¡Œæˆªå›¾ï¼ˆè¿™é‡Œç”¨ç®€åŒ–å®ç°ï¼‰
            // åˆ›å»ºSVGç‰ˆæœ¬ä¾›ä¸‹è½½
            const svg = createSVGFromWordCloud();
            const blob = new Blob([svg], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);

            const link = document.createElement('a');
            link.download = 'wordcloud.svg';
            link.href = url;
            link.click();

            URL.revokeObjectURL(url);
            showNotification('è¯äº‘å›¾ç‰‡ä¸‹è½½å®Œæˆï¼', 'success');
        }

        // åˆ›å»ºSVGæ ¼å¼çš„è¯äº‘
        function createSVGFromWordCloud() {
            const container = document.getElementById('wordCloud');
            const width = container.offsetWidth;
            const height = container.offsetHeight;

            let svg = `<svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">`;
            svg += `<rect width="100%" height="100%" fill="white"/>`;

            wordElements.forEach(({ element, word, position, rotation }) => {
                const fontSize = parseFloat(element.style.fontSize);
                const color = element.style.color;
                const x = position.x;
                const y = position.y;

                svg += `<text x="${x}" y="${y}" font-size="${fontSize}" fill="${color}"
                       text-anchor="middle" dominant-baseline="middle"
                       transform="rotate(${rotation} ${x} ${y})"
                       font-family="Microsoft YaHei, Arial, sans-serif"
                       font-weight="bold">${word.text}</text>`;
            });

            svg += '</svg>';
            return svg;
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // å“åº”å¼å¤„ç†
        window.addEventListener('resize', () => {
            if (currentWords.length > 0) {
                setTimeout(generateWordCloud, 300);
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨ç”Ÿæˆè¯äº‘
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(generateWordCloud, 500);
        });
    </script>
</body>
</html>
